<!-- 
  ** DO NOT EDIT THIS FILE
  ** 
  ** This file was automatically generated. 
  ** 1) Make all changes to `README.yaml` 
  ** 2) Run `make init` (you only need to do this once)
  ** 3) Run`make readme` to rebuild this file. 
  -->
[![README Header][readme_header_img]][readme_header_link]

[![cloudopsworks][logo]](https://cloudops.works/)

# Terraform AWS SSO IdentityStore Admin Module




Terraform module to declaratively manage AWS IAM Identity Center (AWS SSO)
IdentityStore resources: groups, users, and group memberships.
- Creates groups.
- Creates users when not pre-provisioned (provisioned=false).
- Links memberships for both newly created and already-provisioned users (provisioned=true).
Idempotent by design, it derives all desired state from inputs.


---

This project is part of our comprehensive approach towards DevOps Acceleration. 
[<img align="right" title="Share via Email" width="24" height="24" src="https://docs.cloudops.works/images/ionicons/ios-mail.svg"/>][share_email]
[<img align="right" title="Share on Google+" width="24" height="24" src="https://docs.cloudops.works/images/ionicons/logo-googleplus.svg" />][share_googleplus]
[<img align="right" title="Share on Facebook" width="24" height="24" src="https://docs.cloudops.works/images/ionicons/logo-facebook.svg" />][share_facebook]
[<img align="right" title="Share on Reddit" width="24" height="24" src="https://docs.cloudops.works/images/ionicons/logo-reddit.svg" />][share_reddit]
[<img align="right" title="Share on LinkedIn" width="24" height="24" src="https://docs.cloudops.works/images/ionicons/logo-linkedin.svg" />][share_linkedin]
[<img align="right" title="Share on Twitter" width="24" height="24" src="https://docs.cloudops.works/images/ionicons/logo-twitter.svg" />][share_twitter]


[![Terraform Open Source Modules](https://docs.cloudops.works/images/terraform-open-source-modules.svg)][terraform_modules]



It's 100% Open Source and licensed under the [APACHE2](LICENSE).







We have [*lots of terraform modules*][terraform_modules] that are Open Source and we are trying to get them well-maintained!. Check them out!






## Introduction

This module automates day-2 administration of AWS IAM Identity Center (formerly AWS SSO)
by codifying IdentityStore entities and relationships.

What it does
- Discovers your IdentityStore from the active SSO instance.
- Creates/ensures IdentityStore groups.
- Creates users (optional) and sets their attributes (name, emails, addresses, display name).
- Assigns users to groups, regardless of whether the user was created by this module or
  already existed (mark such users as provisioned: true).

Why use it
- Keep SSO identities as code, reviewable and reproducible.
- Consistent tagging and naming metadata via the Cloud Ops Works tags local module.
- Safe for mixed estates: some users managed in HR/IdP, others bootstrapped by Terraform.

Notes
- The module selects the first SSO instance returned by aws_ssoadmin_instances data source.
  If you operate multiple instances, run the module in the account/region that matches your
  intended SSO instance, or wrap with extra selection logic.
- Terraform >= 1.3 and AWS provider ~> 6.4 are required.

## Usage


**IMPORTANT:** The `master` branch is used in `source` just as an example. In your code, do not pin to `master` because there may be breaking changes between releases.
Instead pin to the release tag (e.g. `?ref=vX.Y.Z`) of one of our [latest releases](https://github.com/cloudopsworks/terraform-module-aws-sso-identitystore-admin/releases).


# Inputs (variables)
# Use these inputs via Terraform or Terragrunt. Types shown for clarity; defaults indicate optional.
variables:
  org:
    type: object
    required: true
    attributes:
      organization_name: string
      organization_unit: string
      environment_type: string
      environment_name: string
    description: |
      Organizational context used to build common tags and naming locals.
      Fed into cloudopsworks/tags/local to generate consistent tags.
  is_hub:
    type: bool
    default: false
    required: false
    description: Flag for hub/spoke topologies (used in name locals only).
  spoke_def:
    type: string
    default: "001"
    required: false
    description: Spoke identifier used in name locals.
  extra_tags:
    type: map(string)
    default: {}
    required: false
    description: Additional tags merged with common tags from the tags local module.

  users:
    type: list(object)
    default: []
    required: false
    description: |
      Users to create or reference in the IdentityStore. When provisioned is true, the
      module will NOT create the user but will look it up by user_name (email) and manage
      memberships. When false or omitted, the module will create the user.
    schema:
      - user_name: string            # Typically the email/UPN. Used to locate provisioned users.
        first_name: string
        last_name: string
        display_name: string?        # Optional; defaults to "<first_name> <last_name>".
        provisioned: bool?           # Optional; default false (user created by this module).
        emails:                      # Optional list
          - email: string
            primary: bool?           # Optional
            type: string?            # Optional (e.g. work)
        addresses:                   # Optional list
          - address_line: string
            formatted: string?
            city: string
            region: string
            postal_code: string
            type: string?
        groups:                      # Optional; memberships for this user
          - string                   # Group display_name

  groups:
    type: list(object)
    default: []
    required: false
    description: List of groups to create/ensure.
    schema:
      - display_name: string
        description: string

# Outputs
outputs:
  identity_store_id:
    description: IdentityStore ID resolved from the active SSO instance.
  identity_store_arn:
    description: SSO instance ARN corresponding to the IdentityStore.
  users:
    description: Map of users created by this module keyed by user_name with id and display_name.
  groups:
    description: Map of groups created by this module keyed by display_name with id and display_name.

## Quick Start

prerequisites:
  - Terraform >= 1.3
  - AWS provider ~> 6.4
  - AWS IAM permissions to read SSO instances and manage IdentityStore (sso-admin, identitystore APIs).
  - An AWS IAM Identity Center (SSO) instance already set up in your organization tenant.

steps:
  - Configure AWS credentials and select a region used for IAM Identity Center (e.g., us-east-1).
  - Create a working directory and a terragrunt.hcl using one of the examples above.
  - Run:
    - terragrunt init
    - terragrunt plan
    - terragrunt apply
  - Verify:
    - Groups and users appear in the AWS IAM Identity Center > Users and Groups.
    - Outputs identity_store_id and identity_store_arn are populated.

tips:
  - For existing users from your IdP/HR system, set provisioned: true; only memberships will be managed.
  - Use separate environments/directories per account or scope in Terragrunt to isolate changes.
  - If multiple SSO instances exist, ensure you run in the correct management account/region for the intended instance.


## Examples

# Terragrunt example: basic users and groups
# File: live/sso/terragrunt.hcl
terraform {
  source = "git::https://github.com/cloudopsworks/terraform-module-aws-sso-identitystore-admin.git//"
}

generate "provider" {
  path      = "provider.tf"
  if_exists = "overwrite"
  contents  = <<EOF
  terraform {
    required_version = ">= 1.3"
    required_providers {
      aws = {
        source  = "hashicorp/aws"
        version = "~> 6.4"
      }
    }
  }
  provider "aws" {
    region  = var.region != null ? var.region : "us-east-1"
    profile = var.profile != null ? var.profile : null
  }
  EOF
}

inputs = {
  org = {
    organization_name = "acme"
    organization_unit = "platform"
    environment_type  = "prod"
    environment_name  = "shared"
  }

  groups = [
    { display_name = "Admins", description = "Administrators" },
    { display_name = "Developers", description = "Engineering developers" }
  ]

  users = [
    {
      user_name   = "jane.doe@example.com"
      first_name  = "Jane"
      last_name   = "Doe"
      emails      = [{ email = "jane.doe@example.com", primary = true, type = "work" }]
      groups      = ["Admins", "Developers"]
      provisioned = false  # create the user
    },
    {
      user_name   = "john.provisioned@example.com"
      first_name  = "John"
      last_name   = "Provisioned"
      groups      = ["Developers"]
      provisioned = true   # do not create; look up existing user and set memberships
    }
  ]
}

# Terragrunt example: manage memberships for existing users only
# File: live/sso-memberships/terragrunt.hcl
terraform {
  source = "git::https://github.com/cloudopsworks/terraform-module-aws-sso-identitystore-admin.git//"
}

inputs = {
  org = {
    organization_name = "acme"
    organization_unit = "platform"
    environment_type  = "prod"
    environment_name  = "shared"
  }

  groups = [
    { display_name = "Readers", description = "Read-only access" }
  ]

  users = [
    {
      user_name   = "audit.bot@example.com"
      first_name  = "Audit"
      last_name   = "Bot"
      groups      = ["Readers"]
      provisioned = true
    }
  ]
}

# Terragrunt example: load users/groups from YAML files
# File: live/sso-from-files/terragrunt.hcl
locals {
  users  = yamldecode(file("users.yaml"))
  groups = yamldecode(file("groups.yaml"))
}

terraform {
  source = "git::https://github.com/cloudopsworks/terraform-module-aws-sso-identitystore-admin.git//"
}

inputs = {
  org    = { organization_name = "acme", organization_unit = "security", environment_type = "prod", environment_name = "org" }
  users  = local.users
  groups = local.groups
}

# Example users.yaml
# users:
#   - user_name: alice@example.com
#     first_name: Alice
#     last_name: Allison
#     emails:
#       - email: alice@example.com
#         primary: true
#         type: work
#     groups:
#       - Developers
#
# Example groups.yaml
# groups:
#   - display_name: Developers
#     description: Engineering developers



## Makefile Targets
```
Available targets:

  help                                Help screen
  help/all                            Display help for all targets
  help/short                          This help short screen
  lint                                Lint terraform/opentofu code
  tag                                 Tag the current version

```
## Requirements

| Name | Version |
|------|---------|
| <a name="requirement_terraform"></a> [terraform](#requirement\_terraform) | >= 1.3 |
| <a name="requirement_aws"></a> [aws](#requirement\_aws) | ~> 6.4 |

## Providers

| Name | Version |
|------|---------|
| <a name="provider_aws"></a> [aws](#provider\_aws) | 5.84.0 |

## Modules

| Name | Source | Version |
|------|--------|---------|
| <a name="module_tags"></a> [tags](#module\_tags) | cloudopsworks/tags/local | 1.0.9 |

## Resources

| Name | Type |
|------|------|
| [aws_identitystore_group.group](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/identitystore_group) | resource |
| [aws_identitystore_group_membership.group_membership](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/identitystore_group_membership) | resource |
| [aws_identitystore_group_membership.provisioned_group_membership](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/identitystore_group_membership) | resource |
| [aws_identitystore_user.user](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/identitystore_user) | resource |
| [aws_identitystore_user.user](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/identitystore_user) | data source |
| [aws_region.current](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/region) | data source |
| [aws_ssoadmin_instances.sso](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/ssoadmin_instances) | data source |

## Inputs

| Name | Description | Type | Default | Required |
|------|-------------|------|---------|:--------:|
| <a name="input_extra_tags"></a> [extra\_tags](#input\_extra\_tags) | n/a | `map(string)` | `{}` | no |
| <a name="input_groups"></a> [groups](#input\_groups) | List of groups to create in the identity store | `any` | `[]` | no |
| <a name="input_is_hub"></a> [is\_hub](#input\_is\_hub) | Establish this is a HUB or spoke configuration | `bool` | `false` | no |
| <a name="input_org"></a> [org](#input\_org) | n/a | <pre>object({<br/>    organization_name = string<br/>    organization_unit = string<br/>    environment_type  = string<br/>    environment_name  = string<br/>  })</pre> | n/a | yes |
| <a name="input_spoke_def"></a> [spoke\_def](#input\_spoke\_def) | n/a | `string` | `"001"` | no |
| <a name="input_users"></a> [users](#input\_users) | List of users to create in the identity store | `any` | `[]` | no |

## Outputs

| Name | Description |
|------|-------------|
| <a name="output_groups"></a> [groups](#output\_groups) | n/a |
| <a name="output_identity_store_arn"></a> [identity\_store\_arn](#output\_identity\_store\_arn) | n/a |
| <a name="output_identity_store_id"></a> [identity\_store\_id](#output\_identity\_store\_id) | n/a |
| <a name="output_users"></a> [users](#output\_users) | n/a |



## Help

**Got a question?** We got answers. 

File a GitHub [issue](https://github.com/cloudopsworks/terraform-module-aws-sso-identitystore-admin/issues), send us an [email][email] or join our [Slack Community][slack].

[![README Commercial Support][readme_commercial_support_img]][readme_commercial_support_link]

## DevOps Tools

## Slack Community


## Newsletter

## Office Hours

## Contributing

### Bug Reports & Feature Requests

Please use the [issue tracker](https://github.com/cloudopsworks/terraform-module-aws-sso-identitystore-admin/issues) to report any bugs or file feature requests.

### Developing




## Copyrights

Copyright © 2024-2025 [Cloud Ops Works LLC](https://cloudops.works)





## License 

[![License](https://img.shields.io/badge/License-Apache%202.0-blue.svg)](https://opensource.org/licenses/Apache-2.0) 

See [LICENSE](LICENSE) for full details.

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

      https://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.









## Trademarks

All other trademarks referenced herein are the property of their respective owners.

## About

This project is maintained by [Cloud Ops Works LLC][website]. 


### Contributors

|  [![Cristian Beraha][berahac_avatar]][berahac_homepage]<br/>[Cristian Beraha][berahac_homepage] |
|---|

  [berahac_homepage]: https://github.com/berahac
  [berahac_avatar]: https://github.com/berahac.png?size=50

[![README Footer][readme_footer_img]][readme_footer_link]
[![Beacon][beacon]][website]

  [logo]: https://cloudops.works/logo-300x69.svg
  [docs]: https://cowk.io/docs?utm_source=github&utm_medium=readme&utm_campaign=cloudopsworks/terraform-module-aws-sso-identitystore-admin&utm_content=docs
  [website]: https://cowk.io/homepage?utm_source=github&utm_medium=readme&utm_campaign=cloudopsworks/terraform-module-aws-sso-identitystore-admin&utm_content=website
  [github]: https://cowk.io/github?utm_source=github&utm_medium=readme&utm_campaign=cloudopsworks/terraform-module-aws-sso-identitystore-admin&utm_content=github
  [jobs]: https://cowk.io/jobs?utm_source=github&utm_medium=readme&utm_campaign=cloudopsworks/terraform-module-aws-sso-identitystore-admin&utm_content=jobs
  [hire]: https://cowk.io/hire?utm_source=github&utm_medium=readme&utm_campaign=cloudopsworks/terraform-module-aws-sso-identitystore-admin&utm_content=hire
  [slack]: https://cowk.io/slack?utm_source=github&utm_medium=readme&utm_campaign=cloudopsworks/terraform-module-aws-sso-identitystore-admin&utm_content=slack
  [linkedin]: https://cowk.io/linkedin?utm_source=github&utm_medium=readme&utm_campaign=cloudopsworks/terraform-module-aws-sso-identitystore-admin&utm_content=linkedin
  [twitter]: https://cowk.io/twitter?utm_source=github&utm_medium=readme&utm_campaign=cloudopsworks/terraform-module-aws-sso-identitystore-admin&utm_content=twitter
  [testimonial]: https://cowk.io/leave-testimonial?utm_source=github&utm_medium=readme&utm_campaign=cloudopsworks/terraform-module-aws-sso-identitystore-admin&utm_content=testimonial
  [office_hours]: https://cloudops.works/office-hours?utm_source=github&utm_medium=readme&utm_campaign=cloudopsworks/terraform-module-aws-sso-identitystore-admin&utm_content=office_hours
  [newsletter]: https://cowk.io/newsletter?utm_source=github&utm_medium=readme&utm_campaign=cloudopsworks/terraform-module-aws-sso-identitystore-admin&utm_content=newsletter
  [email]: https://cowk.io/email?utm_source=github&utm_medium=readme&utm_campaign=cloudopsworks/terraform-module-aws-sso-identitystore-admin&utm_content=email
  [commercial_support]: https://cowk.io/commercial-support?utm_source=github&utm_medium=readme&utm_campaign=cloudopsworks/terraform-module-aws-sso-identitystore-admin&utm_content=commercial_support
  [we_love_open_source]: https://cowk.io/we-love-open-source?utm_source=github&utm_medium=readme&utm_campaign=cloudopsworks/terraform-module-aws-sso-identitystore-admin&utm_content=we_love_open_source
  [terraform_modules]: https://cowk.io/terraform-modules?utm_source=github&utm_medium=readme&utm_campaign=cloudopsworks/terraform-module-aws-sso-identitystore-admin&utm_content=terraform_modules
  [readme_header_img]: https://cloudops.works/readme/header/img
  [readme_header_link]: https://cloudops.works/readme/header/link?utm_source=github&utm_medium=readme&utm_campaign=cloudopsworks/terraform-module-aws-sso-identitystore-admin&utm_content=readme_header_link
  [readme_footer_img]: https://cloudops.works/readme/footer/img
  [readme_footer_link]: https://cloudops.works/readme/footer/link?utm_source=github&utm_medium=readme&utm_campaign=cloudopsworks/terraform-module-aws-sso-identitystore-admin&utm_content=readme_footer_link
  [readme_commercial_support_img]: https://cloudops.works/readme/commercial-support/img
  [readme_commercial_support_link]: https://cloudops.works/readme/commercial-support/link?utm_source=github&utm_medium=readme&utm_campaign=cloudopsworks/terraform-module-aws-sso-identitystore-admin&utm_content=readme_commercial_support_link
  [share_twitter]: https://twitter.com/intent/tweet/?text=Terraform+AWS+SSO+IdentityStore+Admin+Module&url=https://github.com/cloudopsworks/terraform-module-aws-sso-identitystore-admin
  [share_linkedin]: https://www.linkedin.com/shareArticle?mini=true&title=Terraform+AWS+SSO+IdentityStore+Admin+Module&url=https://github.com/cloudopsworks/terraform-module-aws-sso-identitystore-admin
  [share_reddit]: https://reddit.com/submit/?url=https://github.com/cloudopsworks/terraform-module-aws-sso-identitystore-admin
  [share_facebook]: https://facebook.com/sharer/sharer.php?u=https://github.com/cloudopsworks/terraform-module-aws-sso-identitystore-admin
  [share_googleplus]: https://plus.google.com/share?url=https://github.com/cloudopsworks/terraform-module-aws-sso-identitystore-admin
  [share_email]: mailto:?subject=Terraform+AWS+SSO+IdentityStore+Admin+Module&body=https://github.com/cloudopsworks/terraform-module-aws-sso-identitystore-admin
  [beacon]: https://ga-beacon.cloudops.works/G-7XWMFVFXZT/cloudopsworks/terraform-module-aws-sso-identitystore-admin?pixel&cs=github&cm=readme&an=terraform-module-aws-sso-identitystore-admin
